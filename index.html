<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥é ä¼°é”æˆå ±è¡¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #0f1419;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: #1e2832;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            overflow: hidden;
            border: 1px solid #2d3748;
        }

        .header {
            background: #2d3748;
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid #4a5568;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header .date-info {
            font-size: 17px;
            opacity: 0.95;
            font-weight: 700;
        }

        .upload-section {
            padding: 30px;
            text-align: center;
            background: #161d27;
            border-bottom: 1px solid #2d3748;
        }

        .upload-area {
            border: 2px dashed #4a5568;
            border-radius: 8px;
            padding: 40px;
            background: #1e2832;
            cursor: pointer;
            transition: all 0.2s;
        }

        .upload-area:hover {
            border-color: #64748b;
            background: #2d3748;
        }

        .upload-area.dragover {
            border-color: #3b82f6;
            background: #2d3748;
        }

        #fileInput {
            display: none;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .table-container {
            padding: 30px;
            overflow-x: auto;
            background: #1e2832;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            background: #161d27;
        }

        thead {
            background: #2d3748;
            color: white;
        }

        th {
            padding: 10px 6px;
            font-weight: 600;
            text-align: center;
            white-space: nowrap;
            border-right: 1px solid #4a5568;
            font-size: 13px;
        }

        th:last-child {
            border-right: none;
        }

        td {
            padding: 8px 6px;
            text-align: right;
            border-bottom: 1px solid #2d3748;
            border-right: 1px solid #2d3748;
            color: #e2e8f0;
        }

        td:last-child {
            border-right: none;
        }

        td:first-child {
            text-align: center;
            font-weight: 600;
            color: #94a3b8;
        }

        tbody tr:hover {
            background: #2d3748;
        }

        .positive {
            color: #10b981;
            font-weight: 600;
        }

        .negative {
            color: #ef4444;
            font-weight: 600;
        }

        .section-divider {
            background: #2d3748;
            height: 2px;
        }

        .section-title {
            background: #1e2832;
            padding: 15px 30px;
            font-weight: 600;
            font-size: 18px;
            color: #e2e8f0;
            border-bottom: 1px solid #2d3748;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .section-title-text {
            text-align: center;
        }

        .export-btn-wrapper {
            position: absolute;
            right: 30px;
        }

        .accumulated-info {
            background: #161d27;
            padding: 10px 30px;
            font-size: 16px;
            font-weight: 600;
            color: #94a3b8;
            border-bottom: 1px solid #2d3748;
        }

        .region-selector {
            padding: 20px 30px;
            background: #1e2832;
            border-bottom: 2px solid #2d3748;
        }

        .region-cards {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .region-card {
            padding: 10px 20px;
            background: #1e2832;
            border: 1px solid #4a5568;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            color: #94a3b8;
            font-size: 14px;
        }

        .region-card:hover {
            background: #2d3748;
            border-color: #64748b;
            color: #e2e8f0;
        }

        .region-card.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .no-data {
            padding: 60px 30px;
            text-align: center;
            color: #94a3b8;
            font-size: 16px;
            background: #1e2832;
        }

        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 5px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #2563eb;
        }

        .export-btn-container {
            padding: 20px 30px;
            background: #1e2832;
            border-bottom: 1px solid #2d3748;
            text-align: center;
        }

        .export-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .export-btn:hover {
            background: #059669;
        }

        .export-btn:disabled {
            background: #4b5563;
            cursor: not-allowed;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .section-title {
                flex-direction: column;
                gap: 10px;
            }
            
            .export-btn-wrapper {
                position: static;
            }
            
            .export-btn {
                padding: 8px 16px;
                font-size: 13px;
            }
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
            .upload-section {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š iStore Taiwan æ—¥é ä¼°é”æˆå ±è¡¨</h1>
            <div class="date-info" id="dateInfo">è«‹ä¸Šå‚³JSONæª”æ¡ˆ</div>
        </div>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“</div>
                <p style="font-size: 16px; margin-bottom: 10px; color: #e2e8f0;">
                    <strong>é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³ JSON æª”æ¡ˆ</strong>
                </p>
                <p style="font-size: 14px; color: #94a3b8;">
                    æ”¯æ´æ ¼å¼ï¼šjson
                </p>
                <input type="file" id="fileInput" accept=".json">
            </div>
        </div>

        <div class="region-selector">
            <div class="region-cards">
                <div class="region-card active" data-region="å…¨ç¤¾">å…¨ç¤¾</div>
                <div class="region-card" data-region="åŒ—ä¸€å€">åŒ—ä¸€å€</div>
                <div class="region-card" data-region="åŒ—äºŒå€">åŒ—äºŒå€</div>
                <div class="region-card" data-region="ä¸­å€">ä¸­å€</div>
                <div class="region-card" data-region="å°å—å€">å°å—å€</div>
                <div class="region-card" data-region="é«˜é›„å€">é«˜é›„å€</div>
            </div>
        </div>

        <div id="dataDisplay" class="no-data">
            å°šæœªè¼‰å…¥æ•¸æ“šï¼Œè«‹ä¸Šå‚³JSONæª”æ¡ˆ
        </div>
    </div>

    <div style="text-align: center; padding: 20px; color: #94a3b8; font-size: 14px;">
        Created by Morio Â© 2025
    </div>

    <script>
        // å€åŸŸå®šç¾©
        const regions = {
            'å…¨ç¤¾': ['45', '47', '48', '51', '57', '65', '61', '75', '76', '77', '81', '84', '86', '88', '89', '97', '115', '116', '117', '820'],
            'åŒ—ä¸€å€': ['45', '47', '48'],
            'åŒ—äºŒå€': ['51', '57', '65', '61'],
            'ä¸­å€': ['75', '76', '77', '81', '84'],
            'å°å—å€': ['86', '88', '89', '97'],
            'é«˜é›„å€': ['115', '116', '117']
        };

        let currentRegion = 'å…¨ç¤¾';
        let currentData = null;
        let currentYesterdayStr = '';
        let currentRemainingDaysInMonth = 0;
        let currentRemainingDaysInYear = 0;

        // å­£åº¦è³‡æ–™
        const quarterData = [
            {"Quarter":"24Q1","Week":"W1","StartDate":"2023-10-01"},
            {"Quarter":"24Q1","Week":"W2","StartDate":"2023-10-08"},
            {"Quarter":"24Q1","Week":"W3","StartDate":"2023-10-15"},
            {"Quarter":"24Q1","Week":"W4","StartDate":"2023-10-22"},
            {"Quarter":"24Q1","Week":"W5","StartDate":"2023-10-29"},
            {"Quarter":"24Q1","Week":"W6","StartDate":"2023-11-05"},
            {"Quarter":"24Q1","Week":"W7","StartDate":"2023-11-12"},
            {"Quarter":"24Q1","Week":"W8","StartDate":"2023-11-19"},
            {"Quarter":"24Q1","Week":"W9","StartDate":"2023-11-26"},
            {"Quarter":"24Q1","Week":"W10","StartDate":"2023-12-03"},
            {"Quarter":"24Q1","Week":"W11","StartDate":"2023-12-10"},
            {"Quarter":"24Q1","Week":"W12","StartDate":"2023-12-17"},
            {"Quarter":"24Q1","Week":"W13","StartDate":"2023-12-24"},
            {"Quarter":"24Q2","Week":"W1","StartDate":"2023-12-31"},
            {"Quarter":"24Q2","Week":"W2","StartDate":"2024-01-07"},
            {"Quarter":"24Q2","Week":"W3","StartDate":"2024-01-14"},
            {"Quarter":"24Q2","Week":"W4","StartDate":"2024-01-21"},
            {"Quarter":"24Q2","Week":"W5","StartDate":"2024-01-28"},
            {"Quarter":"24Q2","Week":"W6","StartDate":"2024-02-04"},
            {"Quarter":"24Q2","Week":"W7","StartDate":"2024-02-11"},
            {"Quarter":"24Q2","Week":"W8","StartDate":"2024-02-18"},
            {"Quarter":"24Q2","Week":"W9","StartDate":"2024-02-25"},
            {"Quarter":"24Q2","Week":"W10","StartDate":"2024-03-03"},
            {"Quarter":"24Q2","Week":"W11","StartDate":"2024-03-10"},
            {"Quarter":"24Q2","Week":"W12","StartDate":"2024-03-17"},
            {"Quarter":"24Q2","Week":"W13","StartDate":"2024-03-24"},
            {"Quarter":"24Q3","Week":"W1","StartDate":"2024-04-07"},
            {"Quarter":"24Q3","Week":"W2","StartDate":"2024-04-14"},
            {"Quarter":"24Q3","Week":"W3","StartDate":"2024-04-21"},
            {"Quarter":"24Q3","Week":"W4","StartDate":"2024-04-28"},
            {"Quarter":"24Q3","Week":"W5","StartDate":"2024-05-05"},
            {"Quarter":"24Q3","Week":"W6","StartDate":"2024-05-12"},
            {"Quarter":"24Q3","Week":"W7","StartDate":"2024-05-19"},
            {"Quarter":"24Q3","Week":"W8","StartDate":"2024-05-26"},
            {"Quarter":"24Q3","Week":"W9","StartDate":"2024-06-02"},
            {"Quarter":"24Q3","Week":"W10","StartDate":"2024-06-09"},
            {"Quarter":"24Q3","Week":"W11","StartDate":"2024-06-16"},
            {"Quarter":"24Q3","Week":"W12","StartDate":"2024-06-23"},
            {"Quarter":"24Q3","Week":"W13","StartDate":"2024-06-30"},
            {"Quarter":"24Q4","Week":"W1","StartDate":"2024-07-07"},
            {"Quarter":"24Q4","Week":"W2","StartDate":"2024-07-14"},
            {"Quarter":"24Q4","Week":"W3","StartDate":"2024-07-21"},
            {"Quarter":"24Q4","Week":"W4","StartDate":"2024-07-28"},
            {"Quarter":"24Q4","Week":"W5","StartDate":"2024-08-04"},
            {"Quarter":"24Q4","Week":"W6","StartDate":"2024-08-11"},
            {"Quarter":"24Q4","Week":"W7","StartDate":"2024-08-18"},
            {"Quarter":"24Q4","Week":"W8","StartDate":"2024-08-25"},
            {"Quarter":"24Q4","Week":"W9","StartDate":"2024-09-01"},
            {"Quarter":"24Q4","Week":"W10","StartDate":"2024-09-08"},
            {"Quarter":"24Q4","Week":"W11","StartDate":"2024-09-15"},
            {"Quarter":"24Q4","Week":"W12","StartDate":"2024-09-22"},
            {"Quarter":"24Q4","Week":"W13","StartDate":"2024-09-29"},
            {"Quarter":"25Q1","Week":"W1","StartDate":"2024-09-29"},
            {"Quarter":"25Q1","Week":"W2","StartDate":"2024-10-06"},
            {"Quarter":"25Q1","Week":"W3","StartDate":"2024-10-13"},
            {"Quarter":"25Q1","Week":"W4","StartDate":"2024-10-20"},
            {"Quarter":"25Q1","Week":"W5","StartDate":"2024-10-27"},
            {"Quarter":"25Q1","Week":"W6","StartDate":"2024-11-03"},
            {"Quarter":"25Q1","Week":"W7","StartDate":"2024-11-10"},
            {"Quarter":"25Q1","Week":"W8","StartDate":"2024-11-17"},
            {"Quarter":"25Q1","Week":"W9","StartDate":"2024-11-24"},
            {"Quarter":"25Q1","Week":"W10","StartDate":"2024-12-01"},
            {"Quarter":"25Q1","Week":"W11","StartDate":"2024-12-08"},
            {"Quarter":"25Q1","Week":"W12","StartDate":"2024-12-15"},
            {"Quarter":"25Q1","Week":"W13","StartDate":"2024-12-22"},
            {"Quarter":"25Q2","Week":"W1","StartDate":"2024-12-29"},
            {"Quarter":"25Q2","Week":"W2","StartDate":"2025-01-05"},
            {"Quarter":"25Q2","Week":"W3","StartDate":"2025-01-12"},
            {"Quarter":"25Q2","Week":"W4","StartDate":"2025-01-19"},
            {"Quarter":"25Q2","Week":"W5","StartDate":"2025-01-26"},
            {"Quarter":"25Q2","Week":"W6","StartDate":"2025-02-02"},
            {"Quarter":"25Q2","Week":"W7","StartDate":"2025-02-09"},
            {"Quarter":"25Q2","Week":"W8","StartDate":"2025-02-16"},
            {"Quarter":"25Q2","Week":"W9","StartDate":"2025-02-23"},
            {"Quarter":"25Q2","Week":"W10","StartDate":"2025-03-02"},
            {"Quarter":"25Q2","Week":"W11","StartDate":"2025-03-09"},
            {"Quarter":"25Q2","Week":"W12","StartDate":"2025-03-16"},
            {"Quarter":"25Q2","Week":"W13","StartDate":"2025-03-23"},
            {"Quarter":"25Q3","Week":"W1","StartDate":"2025-03-30"},
            {"Quarter":"25Q3","Week":"W2","StartDate":"2025-04-06"},
            {"Quarter":"25Q3","Week":"W3","StartDate":"2025-04-13"},
            {"Quarter":"25Q3","Week":"W4","StartDate":"2025-04-20"},
            {"Quarter":"25Q3","Week":"W5","StartDate":"2025-04-27"},
            {"Quarter":"25Q3","Week":"W6","StartDate":"2025-05-04"},
            {"Quarter":"25Q3","Week":"W7","StartDate":"2025-05-11"},
            {"Quarter":"25Q3","Week":"W8","StartDate":"2025-05-18"},
            {"Quarter":"25Q3","Week":"W9","StartDate":"2025-05-25"},
            {"Quarter":"25Q3","Week":"W10","StartDate":"2025-06-01"},
            {"Quarter":"25Q3","Week":"W11","StartDate":"2025-06-08"},
            {"Quarter":"25Q3","Week":"W12","StartDate":"2025-06-15"},
            {"Quarter":"25Q3","Week":"W13","StartDate":"2025-06-22"},
            {"Quarter":"25Q4","Week":"W1","StartDate":"2025-06-29"},
            {"Quarter":"25Q4","Week":"W2","StartDate":"2025-07-06"},
            {"Quarter":"25Q4","Week":"W3","StartDate":"2025-07-13"},
            {"Quarter":"25Q4","Week":"W4","StartDate":"2025-07-20"},
            {"Quarter":"25Q4","Week":"W5","StartDate":"2025-07-27"},
            {"Quarter":"25Q4","Week":"W6","StartDate":"2025-08-03"},
            {"Quarter":"25Q4","Week":"W7","StartDate":"2025-08-10"},
            {"Quarter":"25Q4","Week":"W8","StartDate":"2025-08-17"},
            {"Quarter":"25Q4","Week":"W9","StartDate":"2025-08-24"},
            {"Quarter":"25Q4","Week":"W10","StartDate":"2025-08-31"},
            {"Quarter":"25Q4","Week":"W11","StartDate":"2025-09-07"},
            {"Quarter":"25Q4","Week":"W12","StartDate":"2025-09-14"},
            {"Quarter":"25Q4","Week":"W13","StartDate":"2025-09-21"},
            {"Quarter":"26Q1","Week":"W1","StartDate":"2025-09-28"},
            {"Quarter":"26Q1","Week":"W2","StartDate":"2025-10-05"},
            {"Quarter":"26Q1","Week":"W3","StartDate":"2025-10-12"},
            {"Quarter":"26Q1","Week":"W4","StartDate":"2025-10-19"},
            {"Quarter":"26Q1","Week":"W5","StartDate":"2025-10-26"},
            {"Quarter":"26Q1","Week":"W6","StartDate":"2025-11-02"},
            {"Quarter":"26Q1","Week":"W7","StartDate":"2025-11-09"},
            {"Quarter":"26Q1","Week":"W8","StartDate":"2025-11-16"},
            {"Quarter":"26Q1","Week":"W9","StartDate":"2025-11-23"},
            {"Quarter":"26Q1","Week":"W10","StartDate":"2025-11-30"},
            {"Quarter":"26Q1","Week":"W11","StartDate":"2025-12-07"},
            {"Quarter":"26Q1","Week":"W12","StartDate":"2025-12-14"},
            {"Quarter":"26Q1","Week":"W13","StartDate":"2025-12-21"},
            {"Quarter":"26Q2","Week":"W1","StartDate":"2025-12-28"},
            {"Quarter":"26Q2","Week":"W2","StartDate":"2026-01-04"},
            {"Quarter":"26Q2","Week":"W3","StartDate":"2026-01-11"},
            {"Quarter":"26Q2","Week":"W4","StartDate":"2026-01-18"},
            {"Quarter":"26Q2","Week":"W5","StartDate":"2026-01-25"},
            {"Quarter":"26Q2","Week":"W6","StartDate":"2026-02-01"},
            {"Quarter":"26Q2","Week":"W7","StartDate":"2026-02-08"},
            {"Quarter":"26Q2","Week":"W8","StartDate":"2026-02-15"},
            {"Quarter":"26Q2","Week":"W9","StartDate":"2026-02-22"},
            {"Quarter":"26Q2","Week":"W10","StartDate":"2026-03-01"},
            {"Quarter":"26Q2","Week":"W11","StartDate":"2026-03-08"},
            {"Quarter":"26Q2","Week":"W12","StartDate":"2026-03-15"},
            {"Quarter":"26Q2","Week":"W13","StartDate":"2026-03-22"},
            {"Quarter":"26Q3","Week":"W1","StartDate":"2026-03-29"},
            {"Quarter":"26Q3","Week":"W2","StartDate":"2026-04-05"},
            {"Quarter":"26Q3","Week":"W3","StartDate":"2026-04-12"},
            {"Quarter":"26Q3","Week":"W4","StartDate":"2026-04-19"},
            {"Quarter":"26Q3","Week":"W5","StartDate":"2026-04-26"},
            {"Quarter":"26Q3","Week":"W6","StartDate":"2026-05-03"},
            {"Quarter":"26Q3","Week":"W7","StartDate":"2026-05-10"},
            {"Quarter":"26Q3","Week":"W8","StartDate":"2026-05-17"},
            {"Quarter":"26Q3","Week":"W9","StartDate":"2026-05-24"},
            {"Quarter":"26Q3","Week":"W10","StartDate":"2026-05-31"},
            {"Quarter":"26Q3","Week":"W11","StartDate":"2026-06-07"},
            {"Quarter":"26Q3","Week":"W12","StartDate":"2026-06-14"},
            {"Quarter":"26Q3","Week":"W13","StartDate":"2026-06-21"},
            {"Quarter":"26Q4","Week":"W1","StartDate":"2026-06-28"},
            {"Quarter":"26Q4","Week":"W2","StartDate":"2026-07-05"},
            {"Quarter":"26Q4","Week":"W3","StartDate":"2026-07-12"},
            {"Quarter":"26Q4","Week":"W4","StartDate":"2026-07-19"},
            {"Quarter":"26Q4","Week":"W5","StartDate":"2026-07-26"},
            {"Quarter":"26Q4","Week":"W6","StartDate":"2026-08-02"},
            {"Quarter":"26Q4","Week":"W7","StartDate":"2026-08-09"},
            {"Quarter":"26Q4","Week":"W8","StartDate":"2026-08-16"},
            {"Quarter":"26Q4","Week":"W9","StartDate":"2026-08-23"},
            {"Quarter":"26Q4","Week":"W10","StartDate":"2026-08-30"},
            {"Quarter":"26Q4","Week":"W11","StartDate":"2026-09-06"},
            {"Quarter":"26Q4","Week":"W12","StartDate":"2026-09-13"},
            {"Quarter":"26Q4","Week":"W13","StartDate":"2026-09-20"},
            {"Quarter":"27Q1","Week":"W1","StartDate":"2026-09-27"},
            {"Quarter":"27Q1","Week":"W2","StartDate":"2026-10-04"},
            {"Quarter":"27Q1","Week":"W3","StartDate":"2026-10-11"},
            {"Quarter":"27Q1","Week":"W4","StartDate":"2026-10-18"},
            {"Quarter":"27Q1","Week":"W5","StartDate":"2026-10-25"},
            {"Quarter":"27Q1","Week":"W6","StartDate":"2026-11-01"},
            {"Quarter":"27Q1","Week":"W7","StartDate":"2026-11-08"},
            {"Quarter":"27Q1","Week":"W8","StartDate":"2026-11-15"},
            {"Quarter":"27Q1","Week":"W9","StartDate":"2026-11-22"},
            {"Quarter":"27Q1","Week":"W10","StartDate":"2026-11-29"},
            {"Quarter":"27Q1","Week":"W11","StartDate":"2026-12-06"},
            {"Quarter":"27Q1","Week":"W12","StartDate":"2026-12-13"},
            {"Quarter":"27Q1","Week":"W13","StartDate":"2026-12-20"},
            {"Quarter":"27Q2","Week":"W1","StartDate":"2026-12-27"},
            {"Quarter":"27Q2","Week":"W2","StartDate":"2027-01-03"},
            {"Quarter":"27Q2","Week":"W3","StartDate":"2027-01-10"},
            {"Quarter":"27Q2","Week":"W4","StartDate":"2027-01-17"},
            {"Quarter":"27Q2","Week":"W5","StartDate":"2027-01-24"},
            {"Quarter":"27Q2","Week":"W6","StartDate":"2027-01-31"},
            {"Quarter":"27Q2","Week":"W7","StartDate":"2027-02-07"},
            {"Quarter":"27Q2","Week":"W8","StartDate":"2027-02-14"},
            {"Quarter":"27Q2","Week":"W9","StartDate":"2027-02-21"},
            {"Quarter":"27Q2","Week":"W10","StartDate":"2027-02-28"},
            {"Quarter":"27Q2","Week":"W11","StartDate":"2027-03-07"},
            {"Quarter":"27Q2","Week":"W12","StartDate":"2027-03-14"},
            {"Quarter":"27Q2","Week":"W13","StartDate":"2027-03-21"},
            {"Quarter":"27Q3","Week":"W1","StartDate":"2027-03-28"},
            {"Quarter":"27Q3","Week":"W2","StartDate":"2027-04-04"},
            {"Quarter":"27Q3","Week":"W3","StartDate":"2027-04-11"},
            {"Quarter":"27Q3","Week":"W4","StartDate":"2027-04-18"},
            {"Quarter":"27Q3","Week":"W5","StartDate":"2027-04-25"},
            {"Quarter":"27Q3","Week":"W6","StartDate":"2027-05-02"},
            {"Quarter":"27Q3","Week":"W7","StartDate":"2027-05-09"},
            {"Quarter":"27Q3","Week":"W8","StartDate":"2027-05-16"},
            {"Quarter":"27Q3","Week":"W9","StartDate":"2027-05-23"},
            {"Quarter":"27Q3","Week":"W10","StartDate":"2027-05-30"},
            {"Quarter":"27Q3","Week":"W11","StartDate":"2027-06-06"},
            {"Quarter":"27Q3","Week":"W12","StartDate":"2027-06-13"},
            {"Quarter":"27Q3","Week":"W13","StartDate":"2027-06-20"},
            {"Quarter":"27Q4","Week":"W1","StartDate":"2027-06-27"},
            {"Quarter":"27Q4","Week":"W2","StartDate":"2027-07-04"},
            {"Quarter":"27Q4","Week":"W3","StartDate":"2027-07-11"},
            {"Quarter":"27Q4","Week":"W4","StartDate":"2027-07-18"},
            {"Quarter":"27Q4","Week":"W5","StartDate":"2027-07-25"},
            {"Quarter":"27Q4","Week":"W6","StartDate":"2027-08-01"},
            {"Quarter":"27Q4","Week":"W7","StartDate":"2027-08-08"},
            {"Quarter":"27Q4","Week":"W8","StartDate":"2027-08-15"},
            {"Quarter":"27Q4","Week":"W9","StartDate":"2027-08-22"},
            {"Quarter":"27Q4","Week":"W10","StartDate":"2027-08-29"},
            {"Quarter":"27Q4","Week":"W11","StartDate":"2027-09-05"},
            {"Quarter":"27Q4","Week":"W12","StartDate":"2027-09-12"},
            {"Quarter":"27Q4","Week":"W13","StartDate":"2027-09-19"}
        ];

        // æ ¹æ“šæ—¥æœŸæŸ¥æ‰¾å­£åº¦é€±æ¬¡
        function getQuarterWeek(dateStr) {
            const date = new Date(dateStr);
            
            // æ‰¾åˆ°å°æ‡‰çš„é€±æ¬¡
            for (let i = 0; i < quarterData.length - 1; i++) {
                const currentStart = new Date(quarterData[i].StartDate);
                const nextStart = new Date(quarterData[i + 1].StartDate);
                
                if (date >= currentStart && date < nextStart) {
                    return {
                        quarter: quarterData[i].Quarter,
                        week: quarterData[i].Week
                    };
                }
            }
            
            // æª¢æŸ¥æœ€å¾Œä¸€å€‹å€é–“
            const lastEntry = quarterData[quarterData.length - 1];
            const lastStart = new Date(lastEntry.StartDate);
            if (date >= lastStart) {
                return {
                    quarter: lastEntry.Quarter,
                    week: lastEntry.Week
                };
            }
            
            return null;
        }

        // æ ¼å¼åŒ–æ•¸å­—
        function formatNumber(num) {
            if (num === null || num === undefined) return '-';
            return num.toLocaleString('zh-TW');
        }

        // æ ¼å¼åŒ–ç™¾åˆ†æ¯”
        function formatPercent(num) {
            if (num === null || num === undefined) return '-';
            return num.toFixed(2) + '%';
        }

        // å–å¾—é¡è‰²é¡åˆ¥
        function getColorClass(num) {
            if (num > 0) return 'positive';
            if (num < 0) return 'negative';
            return '';
        }

        // CSVåŒ¯å‡ºåŠŸèƒ½
        function exportToCSV() {
            if (!currentData) {
                alert('è«‹å…ˆä¸Šå‚³æ•¸æ“š');
                return;
            }

            // å–å¾—å€åŸŸåº—å®¶è³‡æ–™
            const regionStoreIds = regions[currentRegion];
            const filteredStores = currentData.stores.filter(store => regionStoreIds.includes(store.storeId));
            const sortedStores = [...filteredStores].sort((a, b) => {
                return parseInt(a.storeId) - parseInt(b.storeId);
            });

            // æ ¼å¼åŒ–æ—¥æœŸ
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const year = yesterday.getFullYear();
            const month = String(yesterday.getMonth() + 1).padStart(2, '0');
            const day = String(yesterday.getDate()).padStart(2, '0');
            const dateStr = `${year}å¹´${month}æœˆ${day}æ—¥`;
            const dateStrShort = `${month}/${day}`;

            // CSVæ¨™é¡Œè¡Œ
            let csv = '\ufeff'; // UTF-8 BOM
            csv += `æ¥­ç¸¾ç¸½è¦½ - ${currentRegion} - ${dateStr} - æœ¬æœˆå‰©é¤˜å¤©æ•¸ï¼š${currentRemainingDaysInMonth}å¤©\n\n`;

            // æœˆåˆ¥æ•¸æ“š
            csv += `æœˆåˆ¥æ•¸æ“š,ç´¯è¨ˆè‡³æ˜¨æ—¥ ${dateStrShort}  æœ¬æœˆå‰©é¤˜å¤©æ•¸ï¼š${currentRemainingDaysInMonth}\n`;
            csv += 'åº—å,ç›®æ¨™(æœˆé ä¼°),é ä¼°æ¥­ç¸¾(æœˆåˆ¥),å¯¦ç¸¾(æœˆåˆ¥),é ä¼°é”æˆç‡(æœˆåˆ¥),é ä¼°å·®è·(æœˆåˆ¥),å»å¹´åŒæœŸ,æˆé•·æ¯”,æˆé•·é‡‘é¡,æœˆè¨ˆé”æˆç‡(æœˆåˆ¥),ç›®æ¨™å·®è·(æœˆåˆ¥)\n';

            // æœˆåˆ¥æ•¸æ“šå…§å®¹
            const monthlyTotal = {
                target: 0,
                estimatedRevenue: 0,
                actualRevenue: 0,
                estimateGap: 0,
                lastYearSamePeriod: 0,
                growthAmount: 0,
                targetGap: 0
            };

            sortedStores.forEach(store => {
                const m = store.monthly;
                monthlyTotal.target += m.target;
                monthlyTotal.estimatedRevenue += m.estimatedRevenue;
                monthlyTotal.actualRevenue += m.actualRevenue;
                monthlyTotal.estimateGap += m.estimateGap;
                monthlyTotal.lastYearSamePeriod += m.lastYearSamePeriod;
                monthlyTotal.growthAmount += m.growthAmount;
                monthlyTotal.targetGap += m.targetGap;

                const achievementRate = m.estimatedRevenue > 0 ? (m.actualRevenue / m.estimatedRevenue * 100) : 0;
                const growthRate = m.lastYearSamePeriod > 0 ? ((m.actualRevenue - m.lastYearSamePeriod) / m.lastYearSamePeriod * 100) : 0;
                const targetAchievementRate = m.target > 0 ? (m.actualRevenue / m.target * 100) : 0;

                csv += `${store.storeId},${Math.round(m.target)},${Math.round(m.estimatedRevenue)},${Math.round(m.actualRevenue)},${achievementRate.toFixed(2)}%,${Math.round(m.estimateGap)},${Math.round(m.lastYearSamePeriod)},${growthRate.toFixed(2)}%,${Math.round(m.growthAmount)},${targetAchievementRate.toFixed(2)}%,${Math.round(m.targetGap)}\n`;
            });

            // æœˆåˆ¥ç¸½è¨ˆ
            const monthlyAchievementRate = monthlyTotal.estimatedRevenue > 0 ? (monthlyTotal.actualRevenue / monthlyTotal.estimatedRevenue * 100) : 0;
            const monthlyGrowthRate = monthlyTotal.lastYearSamePeriod > 0 ? ((monthlyTotal.actualRevenue - monthlyTotal.lastYearSamePeriod) / monthlyTotal.lastYearSamePeriod * 100) : 0;
            const monthlyTargetAchievementRate = monthlyTotal.target > 0 ? (monthlyTotal.actualRevenue / monthlyTotal.target * 100) : 0;

            csv += `ç¸½è¨ˆ,${Math.round(monthlyTotal.target)},${Math.round(monthlyTotal.estimatedRevenue)},${Math.round(monthlyTotal.actualRevenue)},${monthlyAchievementRate.toFixed(2)}%,${Math.round(monthlyTotal.estimateGap)},${Math.round(monthlyTotal.lastYearSamePeriod)},${monthlyGrowthRate.toFixed(2)}%,${Math.round(monthlyTotal.growthAmount)},${monthlyTargetAchievementRate.toFixed(2)}%,${Math.round(monthlyTotal.targetGap)}\n\n`;

            // å¹´åº¦æ•¸æ“š
            csv += `å¹´åº¦æ•¸æ“š,ç´¯è¨ˆè‡³æ˜¨æ—¥ ${dateStrShort}  æœ¬å¹´å‰©é¤˜å¤©æ•¸ï¼š${currentRemainingDaysInYear}\n`;
            csv += 'åº—å,å¹´åº¦ç›®æ¨™,é ä¼°æ¥­ç¸¾(å¹´è¨ˆ),å¯¦ç¸¾(å¹´è¨ˆ),é ä¼°é”æˆç‡(å¹´è¨ˆ),é ä¼°å·®è·(å¹´è¨ˆ),å»å¹´åŒæœŸ,æˆé•·æ¯”,æˆé•·é‡‘é¡,å¹´åº¦é”æˆç‡(å¹´åº¦),ç›®æ¨™å·®è·(å¹´åº¦)\n';

            // å¹´åº¦æ•¸æ“šå…§å®¹
            const yearlyTotal = {
                annualTarget: 0,
                estimatedRevenue: 0,
                actualRevenue: 0,
                estimateGap: 0,
                lastYearSamePeriod: 0,
                growthAmount: 0,
                targetGap: 0
            };

            sortedStores.forEach(store => {
                const y = store.yearly;
                yearlyTotal.annualTarget += y.annualTarget;
                yearlyTotal.estimatedRevenue += y.estimatedRevenue;
                yearlyTotal.actualRevenue += y.actualRevenue;
                yearlyTotal.estimateGap += y.estimateGap;
                yearlyTotal.lastYearSamePeriod += y.lastYearSamePeriod;
                yearlyTotal.growthAmount += y.growthAmount;
                yearlyTotal.targetGap += y.targetGap;

                const achievementRate = y.estimatedRevenue > 0 ? (y.actualRevenue / y.estimatedRevenue * 100) : 0;
                const growthRate = y.lastYearSamePeriod > 0 ? ((y.actualRevenue - y.lastYearSamePeriod) / y.lastYearSamePeriod * 100) : 0;
                const targetAchievementRate = y.annualTarget > 0 ? (y.actualRevenue / y.annualTarget * 100) : 0;

                csv += `${store.storeId},${Math.round(y.annualTarget)},${Math.round(y.estimatedRevenue)},${Math.round(y.actualRevenue)},${achievementRate.toFixed(2)}%,${Math.round(y.estimateGap)},${Math.round(y.lastYearSamePeriod)},${growthRate.toFixed(2)}%,${Math.round(y.growthAmount)},${targetAchievementRate.toFixed(2)}%,${Math.round(y.targetGap)}\n`;
            });

            // å¹´åº¦ç¸½è¨ˆ
            const yearlyAchievementRate = yearlyTotal.estimatedRevenue > 0 ? (yearlyTotal.actualRevenue / yearlyTotal.estimatedRevenue * 100) : 0;
            const yearlyGrowthRate = yearlyTotal.lastYearSamePeriod > 0 ? ((yearlyTotal.actualRevenue - yearlyTotal.lastYearSamePeriod) / yearlyTotal.lastYearSamePeriod * 100) : 0;
            const yearlyTargetAchievementRate = yearlyTotal.annualTarget > 0 ? (yearlyTotal.actualRevenue / yearlyTotal.annualTarget * 100) : 0;

            csv += `ç¸½è¨ˆ,${Math.round(yearlyTotal.annualTarget)},${Math.round(yearlyTotal.estimatedRevenue)},${Math.round(yearlyTotal.actualRevenue)},${yearlyAchievementRate.toFixed(2)}%,${Math.round(yearlyTotal.estimateGap)},${Math.round(yearlyTotal.lastYearSamePeriod)},${yearlyGrowthRate.toFixed(2)}%,${Math.round(yearlyTotal.growthAmount)},${yearlyTargetAchievementRate.toFixed(2)}%,${Math.round(yearlyTotal.targetGap)}\n`;

            // ä¸‹è¼‰CSV
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `æ—¥é ä¼°é”æˆ_${currentRegion}_${dateStr}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable(data, yesterdayStr, remainingDaysInMonth, remainingDaysInYear, region = 'å…¨ç¤¾') {
            // æŒ‰ç…§ storeId æ•¸å­—æ’åºï¼Œä¸¦æ ¹æ“šå€åŸŸç¯©é¸
            const regionStoreIds = regions[region];
            const filteredStores = data.stores.filter(store => regionStoreIds.includes(store.storeId));
            const sortedStores = [...filteredStores].sort((a, b) => {
                return parseInt(a.storeId) - parseInt(b.storeId);
            });

            let html = `
                <div class="table-container">
                    <div class="section-title">
                        <span class="section-title-text">ğŸ“ˆ æœˆåˆ¥æ•¸æ“š</span>
                        <div class="export-btn-wrapper">
                            <button class="export-btn" id="exportBtn" disabled>ğŸ“¥ åŒ¯å‡º CSV</button>
                        </div>
                    </div>
                    <div class="accumulated-info">ç´¯è¨ˆè‡³æ˜¨æ—¥ ${yesterdayStr}&emsp;&emsp;æœ¬æœˆå‰©é¤˜å¤©æ•¸ï¼š${remainingDaysInMonth}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>åº—å</th>
                                <th>ç›®æ¨™<br>(æœˆé ä¼°)</th>
                                <th>é ä¼°æ¥­ç¸¾<br>(æœˆåˆ¥)</th>
                                <th>å¯¦ç¸¾<br>(æœˆåˆ¥)</th>
                                <th>é ä¼°é”æˆç‡<br>(æœˆåˆ¥)</th>
                                <th>é ä¼°å·®è·<br>(æœˆåˆ¥)</th>
                                <th>å»å¹´åŒæœŸ</th>
                                <th>æˆé•·æ¯”</th>
                                <th>æˆé•·é‡‘é¡</th>
                                <th>æœˆè¨ˆé”æˆç‡<br>(æœˆåˆ¥)</th>
                                <th>ç›®æ¨™å·®è·<br>(æœˆåˆ¥)</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            sortedStores.forEach(store => {
                const m = store.monthly;
                html += `
                    <tr>
                        <td>${store.storeId}</td>
                        <td>${formatNumber(m.target)}</td>
                        <td>${formatNumber(m.estimatedRevenue)}</td>
                        <td>${formatNumber(m.actualRevenue)}</td>
                        <td class="${getColorClass(m.achievementRate - 100)}">${formatPercent(m.achievementRate)}</td>
                        <td class="${getColorClass(m.estimateGap)}">${formatNumber(m.estimateGap)}</td>
                        <td>${formatNumber(m.lastYearSamePeriod)}</td>
                        <td class="${getColorClass(m.growthRate)}">${formatPercent(m.growthRate)}</td>
                        <td class="${getColorClass(m.growthAmount)}">${formatNumber(m.growthAmount)}</td>
                        <td class="${getColorClass(m.targetAchievementRate - 100)}">${formatPercent(m.targetAchievementRate)}</td>
                        <td class="${getColorClass(m.targetGap)}">${formatNumber(m.targetGap)}</td>
                    </tr>
                `;
            });

            // è¨ˆç®—æœˆåˆ¥ç¸½è¨ˆ
            const monthlyTotal = {
                target: 0,
                estimatedRevenue: 0,
                actualRevenue: 0,
                estimateGap: 0,
                lastYearSamePeriod: 0,
                growthAmount: 0,
                targetGap: 0
            };

            sortedStores.forEach(store => {
                const m = store.monthly;
                monthlyTotal.target += m.target;
                monthlyTotal.estimatedRevenue += m.estimatedRevenue;
                monthlyTotal.actualRevenue += m.actualRevenue;
                monthlyTotal.estimateGap += m.estimateGap;
                monthlyTotal.lastYearSamePeriod += m.lastYearSamePeriod;
                monthlyTotal.growthAmount += m.growthAmount;
                monthlyTotal.targetGap += m.targetGap;
            });

            // è¨ˆç®—ç¸½è¨ˆçš„ç™¾åˆ†æ¯”
            const monthlyAchievementRate = monthlyTotal.estimatedRevenue > 0 
                ? (monthlyTotal.actualRevenue / monthlyTotal.estimatedRevenue * 100) 
                : 0;
            const monthlyGrowthRate = monthlyTotal.lastYearSamePeriod > 0 
                ? ((monthlyTotal.actualRevenue - monthlyTotal.lastYearSamePeriod) / monthlyTotal.lastYearSamePeriod * 100) 
                : 0;
            const monthlyTargetAchievementRate = monthlyTotal.target > 0 
                ? (monthlyTotal.actualRevenue / monthlyTotal.target * 100) 
                : 0;

            html += `
                        </tbody>
                        <tfoot style="background: #2d3748; font-weight: 700; border-top: 2px solid #4a5568;">
                            <tr>
                                <td style="text-align: center; color: #94a3b8;">ç¸½è¨ˆ</td>
                                <td>${formatNumber(monthlyTotal.target)}</td>
                                <td>${formatNumber(monthlyTotal.estimatedRevenue)}</td>
                                <td>${formatNumber(monthlyTotal.actualRevenue)}</td>
                                <td class="${getColorClass(monthlyAchievementRate - 100)}">${formatPercent(monthlyAchievementRate)}</td>
                                <td class="${getColorClass(monthlyTotal.estimateGap)}">${formatNumber(monthlyTotal.estimateGap)}</td>
                                <td>${formatNumber(monthlyTotal.lastYearSamePeriod)}</td>
                                <td class="${getColorClass(monthlyGrowthRate)}">${formatPercent(monthlyGrowthRate)}</td>
                                <td class="${getColorClass(monthlyTotal.growthAmount)}">${formatNumber(monthlyTotal.growthAmount)}</td>
                                <td class="${getColorClass(monthlyTargetAchievementRate - 100)}">${formatPercent(monthlyTargetAchievementRate)}</td>
                                <td class="${getColorClass(monthlyTotal.targetGap)}">${formatNumber(monthlyTotal.targetGap)}</td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    <div class="section-divider"></div>
                    
                    <div class="section-title">
                        <span class="section-title-text">ğŸ“Š å¹´åº¦æ•¸æ“š</span>
                    </div>
                    <div class="accumulated-info">ç´¯è¨ˆè‡³æ˜¨æ—¥ ${yesterdayStr}&emsp;&emsp;æœ¬å¹´å‰©é¤˜å¤©æ•¸ï¼š${remainingDaysInYear}</div>
                    <table>
                        <thead>
                            <tr>
                                <th>åº—å</th>
                                <th>å¹´åº¦ç›®æ¨™</th>
                                <th>é ä¼°æ¥­ç¸¾<br>(å¹´è¨ˆ)</th>
                                <th>å¯¦ç¸¾<br>(å¹´è¨ˆ)</th>
                                <th>é ä¼°é”æˆç‡<br>(å¹´è¨ˆ)</th>
                                <th>é ä¼°å·®è·<br>(å¹´è¨ˆ)</th>
                                <th>å»å¹´åŒæœŸ</th>
                                <th>æˆé•·æ¯”</th>
                                <th>æˆé•·é‡‘é¡</th>
                                <th>å¹´åº¦é”æˆç‡<br>(å¹´åº¦)</th>
                                <th>ç›®æ¨™å·®è·<br>(å¹´åº¦)</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            sortedStores.forEach(store => {
                const y = store.yearly;
                html += `
                    <tr>
                        <td>${store.storeId}</td>
                        <td>${formatNumber(y.annualTarget)}</td>
                        <td>${formatNumber(y.estimatedRevenue)}</td>
                        <td>${formatNumber(y.actualRevenue)}</td>
                        <td class="${getColorClass(y.achievementRate - 100)}">${formatPercent(y.achievementRate)}</td>
                        <td class="${getColorClass(y.estimateGap)}">${formatNumber(y.estimateGap)}</td>
                        <td>${formatNumber(y.lastYearSamePeriod)}</td>
                        <td class="${getColorClass(y.growthRate)}">${formatPercent(y.growthRate)}</td>
                        <td class="${getColorClass(y.growthAmount)}">${formatNumber(y.growthAmount)}</td>
                        <td class="${getColorClass(y.targetAchievementRate - 100)}">${formatPercent(y.targetAchievementRate)}</td>
                        <td class="${getColorClass(y.targetGap)}">${formatNumber(y.targetGap)}</td>
                    </tr>
                `;
            });

            // è¨ˆç®—å¹´åº¦ç¸½è¨ˆ
            const yearlyTotal = {
                annualTarget: 0,
                estimatedRevenue: 0,
                actualRevenue: 0,
                estimateGap: 0,
                lastYearSamePeriod: 0,
                growthAmount: 0,
                targetGap: 0
            };

            sortedStores.forEach(store => {
                const y = store.yearly;
                yearlyTotal.annualTarget += y.annualTarget;
                yearlyTotal.estimatedRevenue += y.estimatedRevenue;
                yearlyTotal.actualRevenue += y.actualRevenue;
                yearlyTotal.estimateGap += y.estimateGap;
                yearlyTotal.lastYearSamePeriod += y.lastYearSamePeriod;
                yearlyTotal.growthAmount += y.growthAmount;
                yearlyTotal.targetGap += y.targetGap;
            });

            // è¨ˆç®—ç¸½è¨ˆçš„ç™¾åˆ†æ¯”
            const yearlyAchievementRate = yearlyTotal.estimatedRevenue > 0 
                ? (yearlyTotal.actualRevenue / yearlyTotal.estimatedRevenue * 100) 
                : 0;
            const yearlyGrowthRate = yearlyTotal.lastYearSamePeriod > 0 
                ? ((yearlyTotal.actualRevenue - yearlyTotal.lastYearSamePeriod) / yearlyTotal.lastYearSamePeriod * 100) 
                : 0;
            const yearlyTargetAchievementRate = yearlyTotal.annualTarget > 0 
                ? (yearlyTotal.actualRevenue / yearlyTotal.annualTarget * 100) 
                : 0;

            html += `
                        </tbody>
                        <tfoot style="background: #2d3748; font-weight: 700; border-top: 2px solid #4a5568;">
                            <tr>
                                <td style="text-align: center; color: #94a3b8;">ç¸½è¨ˆ</td>
                                <td>${formatNumber(yearlyTotal.annualTarget)}</td>
                                <td>${formatNumber(yearlyTotal.estimatedRevenue)}</td>
                                <td>${formatNumber(yearlyTotal.actualRevenue)}</td>
                                <td class="${getColorClass(yearlyAchievementRate - 100)}">${formatPercent(yearlyAchievementRate)}</td>
                                <td class="${getColorClass(yearlyTotal.estimateGap)}">${formatNumber(yearlyTotal.estimateGap)}</td>
                                <td>${formatNumber(yearlyTotal.lastYearSamePeriod)}</td>
                                <td class="${getColorClass(yearlyGrowthRate)}">${formatPercent(yearlyGrowthRate)}</td>
                                <td class="${getColorClass(yearlyTotal.growthAmount)}">${formatNumber(yearlyTotal.growthAmount)}</td>
                                <td class="${getColorClass(yearlyTargetAchievementRate - 100)}">${formatPercent(yearlyTargetAchievementRate)}</td>
                                <td class="${getColorClass(yearlyTotal.targetGap)}">${formatNumber(yearlyTotal.targetGap)}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;

            return html;
        }

        // è™•ç†æª”æ¡ˆä¸Šå‚³
        function handleFile(file) {
            if (!file || !file.name.endsWith('.json')) {
                alert('è«‹ä¸Šå‚³ .json æª”æ¡ˆ');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // ä½¿ç”¨ç•¶å‰æ—¥æœŸï¼ˆä»Šå¤©ï¼‰
                    const today = new Date();
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    // è¨ˆç®—æœ¬æœˆå‰©é¤˜å¤©æ•¸ï¼ˆåŒ…å«ä»Šå¤©ï¼‰
                    const lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    const remainingDaysInMonth = lastDayOfMonth.getDate() - today.getDate() + 1;
                    
                    // è¨ˆç®—æœ¬å¹´å‰©é¤˜å¤©æ•¸ï¼ˆåŒ…å«ä»Šå¤©ï¼‰
                    const lastDayOfYear = new Date(today.getFullYear(), 11, 31);
                    const remainingDaysInYear = Math.ceil((lastDayOfYear - today) / (1000 * 60 * 60 * 24)) + 1;
                    
                    // æ ¼å¼åŒ–æ˜¨å¤©æ—¥æœŸ
                    const yesterdayStr = `${yesterday.getMonth() + 1}/${yesterday.getDate()}`;
                    
                    // å–å¾—å­£åº¦é€±æ¬¡è³‡è¨Šï¼ˆä½¿ç”¨ä»Šå¤©çš„æ—¥æœŸï¼‰
                    const todayDateStr = today.toISOString().split('T')[0];
                    const quarterWeek = getQuarterWeek(todayDateStr);
                    
                    const dateStr = `${today.getMonth() + 1}/${today.getDate()}`;
                    
                    if (quarterWeek) {
                        document.getElementById('dateInfo').textContent = 
                            `FY${quarterWeek.quarter}${quarterWeek.week} ${dateStr}`;
                    } else {
                        document.getElementById('dateInfo').textContent = 
                            `å ±è¡¨æ—¥æœŸ: ${dateStr}`;
                    }
                    
                    // å„²å­˜ç•¶å‰æ•¸æ“š
                    currentData = data;
                    currentYesterdayStr = yesterdayStr;
                    currentRemainingDaysInMonth = remainingDaysInMonth;
                    currentRemainingDaysInYear = remainingDaysInYear;
                    
                    // æ¸²æŸ“è¡¨æ ¼ï¼ˆå‚³å…¥å‰©é¤˜å¤©æ•¸è³‡è¨Šå’Œç•¶å‰å€åŸŸï¼‰
                    document.getElementById('dataDisplay').innerHTML = renderTable(data, yesterdayStr, remainingDaysInMonth, remainingDaysInYear, currentRegion);
                    
                    // å•Ÿç”¨åŒ¯å‡ºæŒ‰éˆ•ä¸¦ç¶å®šäº‹ä»¶
                    const exportBtn = document.getElementById('exportBtn');
                    if (exportBtn) {
                        exportBtn.disabled = false;
                        exportBtn.onclick = exportToCSV;
                    }
                    
                } catch (error) {
                    alert('JSON æ ¼å¼éŒ¯èª¤: ' + error.message);
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }

        // è¨­å®šäº‹ä»¶ç›£è½
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // æ‹–æ›³ä¸Šå‚³
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            if (e.dataTransfer.files.length > 0) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        // å€åŸŸå¡ç‰‡åˆ‡æ›äº‹ä»¶
        document.querySelectorAll('.region-card').forEach(card => {
            card.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰activeé¡åˆ¥
                document.querySelectorAll('.region-card').forEach(c => c.classList.remove('active'));
                // æ·»åŠ activeåˆ°ç•¶å‰å¡ç‰‡
                this.classList.add('active');
                
                // æ›´æ–°ç•¶å‰å€åŸŸ
                currentRegion = this.dataset.region;
                
                // å¦‚æœæœ‰æ•¸æ“šï¼Œé‡æ–°æ¸²æŸ“
                if (currentData) {
                    document.getElementById('dataDisplay').innerHTML = renderTable(
                        currentData, 
                        currentYesterdayStr, 
                        currentRemainingDaysInMonth, 
                        currentRemainingDaysInYear,
                        currentRegion
                    );
                    
                    // é‡æ–°ç¶å®šåŒ¯å‡ºæŒ‰éˆ•äº‹ä»¶
                    const exportBtn = document.getElementById('exportBtn');
                    if (exportBtn) {
                        exportBtn.disabled = false;
                        exportBtn.onclick = exportToCSV;
                    }
                }
            });
        });
    </script>
</body>
</html>
